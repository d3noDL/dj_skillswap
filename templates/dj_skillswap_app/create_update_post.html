{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-5">
  <h3 class="mb-4">
    {% if post_form.instance.id %}
      Edit Skill Swap
    {% else %}
      Post a Skill Swap
    {% endif %}
  </h3>

  <form method="post" novalidate>
    {% csrf_token %}
    {{ post_form|crispy }}
    <!-- Submit button is defined via FormHelper, but you can also keep this -->
    <button type="submit" class="btn btn-primary mt-3">Save</button>
  </form>
</div>
{% endblock %}

{% block script %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const category = document.getElementById('id_category');
    const skill = document.getElementById('id_skill');
    category.addEventListener('change', function () {
      skill.innerHTML = '<option>Loading...</option>';
      fetch(`/app/get-skills/?category_id=${this.value}`)
        .then(r => r.json())
        .then(data => {
          skill.innerHTML = '<option>Select a skill</option>';
          data.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.id;
            opt.textContent = s.name;
            skill.appendChild(opt);
          });
        }).catch(() => {
          skill.innerHTML = '<option>Error loading skills</option>';
        });
    });
  });
</script>
{% endblock %}
