{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="row">
	<div class="col-lg-12 mb-2 mb-sm-5">
		<div class="mb-3 text-end">
			<button onclick="history.back()" class="btn btn-outline-secondary">← Back</button>
		</div>
		<div class="card card-style1 border-0">
			<div class="card-body p-1-9 p-sm-2-3 p-md-6 p-lg-7">
				<div class="row align-items-center">
					
					<!-- Avatar + Rating -->
					<div class="col-lg-4 d-flex flex-column justify-content-center align-items-center mb-4 mb-lg-0">
						
						{% if post_data.profile.profile_picture %}
						<img src="{{ post_data.profile.profile_picture.url }}" alt="Profile picture" class="img-fluid mb-3"
							style="max-width: 250px; height: auto;">
						{% else %}
						<img src="{% static 'images/avatar-placeholder.jpg' %}" alt="Profile picture" class="img-fluid mb-3"
							style="max-width: 250px; height: auto;">
						{% endif %}
						<h5 class=" mb-2 text-dark">
						{{ post_data.profile }}
					</h5>
						<!-- Rating -->
						<div class="star-rating readonly d-flex">
							{% for i in "12345" %}
							{% if i|add:"0" <= post_data.profile.average_rating %} <i class="bi bi-star-fill text-warning"></i>
								{% elif i|add:"0" < post_data.profile.average_rating|add:"1" %} <i class="bi bi-star-half text-warning">
									</i>
									{% else %}
									<i class="bi bi-star text-warning"></i>
									{% endif %}
									{% endfor %}
						</div>
					</div>

					<!-- Post info -->
					<div class="col-lg-8 px-xl-10 d-flex flex-column justify-content-between h-100">
						<!-- Cabeçalho -->
						<div class="card-header py-2 px-3 mb-3 rounded w-100 d-flex justify-content-between align-items-center">
							<div>
								<h3 class="h4 mb-0">{{ post_data.skill }}</h3>
								<span class="text-secondary small">{{ post_type }}</span>
							</div>

							{% if request.user == post_data.profile.user %}
							<div class="dropdown">
								<a class="text-body dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
									aria-expanded="false">
									<i class="bx bx-dots-horizontal-rounded"></i>
								</a>
								<ul class="dropdown-menu dropdown-menu-end fs-6">
									<li><a class="dropdown-item" href="{% url 'dj_skillswap_app:post_update' post_data.id %}">Edit</a>
									</li>
									{% if post.status %}
									<li><a class="dropdown-item"
											href="{% url 'dj_skillswap_app:toggle_post_status' post_data.id %}">Deactivate</a></li>
									{% else %}
									<li><a class="dropdown-item text-success"
											href="{% url 'dj_skillswap_app:toggle_post_status' post_data.id %}">Activate</a></li>
									{% endif %}
								</ul>
							</div>
							{% endif %}
						</div>

						<!-- Conteúdo -->
						<div class="flex-grow-1">
							<!-- Why me? + Status -->
							<div class="d-flex justify-content-between align-items-center mb-3">
								<span class="fw-semibold text-secondary">Why me?</span>
								<span class="badge badge-{{ post_data.status|yesno:'soft-success,soft-danger' }}">
									{{ post_data.status|yesno:"Active,Inactive" }}
								</span>
							</div>
							<p class="fw-semibold">{{ post_data.pitch }}</p>

							<!-- Description -->
							<div class="mb-3">
								<span class="fw-semibold text-secondary">{{ post_what }}</span>
								<p>{{ post_data.description }}</p>
							</div>

							<!-- Availability -->
							<div class="mb-3">
								<span class="fw-semibold text-secondary">When?</span>
								<p>{{ post_data.avaliability }}</p>
							</div>
						</div>

						<!-- Buttons: Only visible if user is NOT the post owner -->
						{% if request.user != post_data.profile.user %}
						<div class="mt-auto text-end">
							<a href="{% url 'dj_skillswap_app:send_review' post_data.profile.id %}" class="btn button">Review</a>
							<a href="{% url 'dj_skillswap_app:send_message'  %}" class="btn button">Contact</a>
						</div>
						{% endif %}
					</div>

				</div>
			</div>
		</div>
	</div>
</div>
<!-- Grid dos cards -->
<div class="row justify-content-center">
	<h5 class="mb-3">Latest Reviews</h5>
	{% for review in reviews %}
	<div class="col-12 col-md-6 col-lg-4 col-xl-3">
		{% include "partials/review_card.html" with review=review %}
	</div>
	{% endfor %}
</div>
{% endblock %}